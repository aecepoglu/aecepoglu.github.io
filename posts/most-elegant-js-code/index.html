<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <meta name="description" content="">

    
      <link href="https://fonts.googleapis.com/css?family=Open+Sans:400|Old+Standard+TT:400&display=swap" rel="stylesheet" media="print" type="text/css" onload="this.media='all'">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='/css/codehl.css' rel="stylesheet">
    

    <title>
      
      
         En Güzel JavaScript kodu: Akış Şeması Programlama 
      
    </title>
    <link rel="canonical" href="/posts/most-elegant-js-code/">

    <style>
  * {
    border:0;
    font:inherit;
    font-size:100%;
    vertical-align:baseline;
    margin:0;
    padding:0;
    color: black;
    text-decoration-skip: ink;
  }

  body {
    font-family:'Open Sans', 'Myriad Pro', Myriad, sans-serif;
    font-size:17px;
    line-height:160%;
    color:#1d1313;
    max-width:700px;
    margin:auto;
  }

  p {
    margin: 20px 0;
  }

  a img {
    border:none;
  }

  img {
    margin: 10px auto 10px auto;
    max-width: 100%;
    display: block;
  }

  .left-justify { float: left; }
  .right-justify { float:right; }

  pre, code {
    font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
    background-color: #f7f7f7;
  }

  code {
    font-size: 12px;
    padding: 4px;
  }

  pre {
    margin-top: 0;
    margin-bottom: 16px;
    word-wrap: normal;
    padding: 16px;
    overflow: auto;
    font-size: 85%;
    line-height: 1.45;
  }

  pre>code {
    padding: 0;
    margin: 0;
    font-size: 100%;
    word-break: normal;
    white-space: pre;
    background: transparent;
    border: 0;
  }

  pre code {
    display: inline;
    padding: 0;
    margin: 0;
    overflow: visible;
    line-height: inherit;
    word-wrap: normal;
    background-color: transparent;
    border: 0;
  }

  pre code::before,
  pre code::after {
    content: normal;
  }

  em,q,em,dfn {
    font-style:italic;
  }

  .sans,html .gist .gist-file .gist-meta {
    font-family:"Open Sans","Myriad Pro",Myriad,sans-serif;
  }

  .mono,pre,code,tt,p code,li code {
    font-family:Menlo,Monaco,"Andale Mono","lucida console","Courier New",monospace;
  }

  .heading,.serif,h1,h2,h3 {
    font-family:"Old Standard TT",serif;
  }

  strong {
    font-weight:600;
  }

  q:before {
    content:"\201C";
  }

  q:after {
    content:"\201D";
  }

  del,s {
    text-decoration:line-through;
  }

  blockquote {
    font-family:"Old Standard TT",serif;
    text-align:center;
    padding:50px;
  }

  blockquote p {
    display:inline-block;
    font-style:italic;
  }

  blockquote:before,blockquote:after {
    font-family:"Old Standard TT",serif;
    content:'\201C';
    font-size:35px;
    color:#403c3b;
  }

  blockquote:after {
    content:'\201D';
  }

  hr {
    width:40%;
    height: 1px;
    background:#403c3b;
    margin: 25px auto;
  }

  h1 {
    font-size:35px;
  }

  h2 {
    font-size:28px;
  }

  h3 {
    font-size:22px;
    margin-top:18px;
  }

  h1 a,h2 a,h3 a {
    text-decoration:none;
  }

  h1,h2 {
    margin-top:28px;
  }

  #sub-header, .date {
    color:#403c3b;
    font-size:13px;
  }

  #sub-header {
    margin: 0 4px;
  }

  #nav h1 a {
    font-size:35px;
    color:#1d1313;
    line-height:120%;
  }

  .posts_listing a,#nav a {
    text-decoration: none;
  }

  li {
    margin-left: 20px;
  }

  ul li {
    margin-left: 5px;
  }

  ul li {
    list-style-type: none;
  }
  ul li:before {
    content:"\00BB \0020";
  }

  #nav ul li:before, .posts_listing li:before {
    content:'';
    margin-right:0;
  }

  #content {
    text-align:left;
    width:100%;
    font-size:15px;
     
  }

  #content h1,#content h2 {
    margin-bottom:5px;
  }

  #content h2 {
    font-size:25px;
  }

  #content .entry-content {
    margin-top:15px;
  }

  #content .date {
    margin-left:3px;
  }

  #content h1 {
    font-size:30px;
  }

  .highlight {
    margin: 10px 0;
  }

  .posts_listing {
    margin:0 0 50px;
  }

  .posts_listing li {
    margin:0 0 25px 15px;
  }

  .posts_listing li a:hover,#nav a:hover {
    text-decoration: underline;
  }

  #nav {
    text-align:center;
    position:static;
    margin-top:60px;
    margin-bottom: 40px;
  }

  #nav ul {
    display: table;
    margin: 8px auto 0 auto;
  }

  #nav li {
    list-style-type:none;
    display:table-cell;
    font-size:15px;
    padding: 0 20px;
  }

  #links {
    display: flex;
    justify-content: space-between;
    margin: 50px 0 0 0;
  }

  #links :nth-child(1) {
    margin-right:0.5em;;
  }

  #links :nth-child(2) {
    margin-left:0.5em;;
  }

  #not-found {
    text-align: center;
  }

  #not-found a {
    font-family:"Old Standard TT",serif;
    font-size: 200px;
    text-decoration: none;
    display: inline-block;
    padding-top: 225px;
  }

  @media (max-width: 750px) {
    body {
      padding-left:20px;
      padding-right:20px;
    }

    #nav h1 a {
      font-size:28px;
    }

    #nav li {
      font-size:13px;
      padding: 0 15px;
    }

    #content {
      margin-top:0;
       
      font-size:14px;
    }

    #content h1 {
      font-size:25px;
    }

    #content h2 {
      font-size:22px;
    }

    .posts_listing li div {
      font-size:12px;
    }
  }

  @media (max-width: 400px) {
    body {
      padding-left:20px;
      padding-right:20px;
    }

    #nav h1 a {
      font-size:22px;
    }

    #nav li {
      font-size:12px;
      padding: 0 10px;
    }

    #content {
      margin-top:0;
      padding-top:20px;
      font-size:12px;
    }

    #content h1 {
      font-size:20px;
    }

    #content h2 {
      font-size:18px;
    }

    .posts_listing li div{
      font-size:12px;
    }
  }

  @media (prefers-color-scheme: dark) {
    *, #nav h1 a {
      color: #FDFDFD;
    }

    body {
      background: #121212;
    }

    pre, code {
      background-color: #262626;
    }

    #sub-header, .date {
      color: #BABABA;
    }

    hr {
      background: #EBEBEB;
    }
  }
</style>


    <link href='/css/adoc.css' rel="stylesheet">
    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
	displayAlign: "left",
	asciimath2jax: {
		delimiters: [['\\$', '\\$']]
	}
});
</script>


<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=AM_HTMLorMML"> </script>

  </head>

  <body>
    <section id=nav>
      <h1><a href="/">aecepoglu</a></h1>
      <ul>
        
          <li><a href="/posts/index.xml">rss</a></li>
        
          <li><a href="/en/about/">en</a></li>
        
          <li><a href="/tr/">tr</a></li>
        
          <li><a href="/projects/">yaptıklarım</a></li>
        
          <li><a href="/about">hakkımda</a></li>
        
      </ul>
    </section>


<section id=content>
  <h1> En Güzel JavaScript kodu: Akış Şeması Programlama </h1>

  
    <div id=sub-header>
      December 2019 · 5 minute read
    </div>
  

  <div class="entry-content">
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Aşağıdaki satırlar, işyerindeki tüm ekibimizin birkaç senelik eforunun en lezzetli meyvelerinden.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">route</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">&#34;</span><span class="s2">/api/proxy</span><span class="dl">&#34;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">saveAnyway</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">saveAnyway</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">noHealthCheck</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">noHealthCheck</span><span class="p">;</span>
  <span class="kd">function</span> <span class="nx">save</span><span class="p">(</span><span class="nx">proxy</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">proxy</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">saved</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">saved</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">new</span> <span class="nx">ProxyResource</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">proxy</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">proxy</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="dl">&#34;</span><span class="s2">valid</span><span class="dl">&#34;</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">saveAnyway</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">save</span><span class="p">(</span><span class="nx">proxy</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">proxy</span><span class="p">;</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">proxy</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">noHealthCheck</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">promises</span> <span class="o">=</span> <span class="nx">HealthService</span><span class="p">.</span><span class="nx">checkProxies</span><span class="p">([</span><span class="nx">proxy</span><span class="p">]);</span>
        <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">promises</span><span class="p">)</span>
          <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">save</span><span class="p">();</span>
          <span class="p">})</span>
          <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">proxy</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="p">(</span><span class="nx">result</span> <span class="o">&amp;&amp;</span> <span class="nx">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">?</span> <span class="dl">&#34;</span><span class="s2">valid</span><span class="dl">&#34;</span> <span class="p">:</span> <span class="dl">&#34;</span><span class="s2">invalid</span><span class="dl">&#34;</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">proxy</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="dl">&#34;</span><span class="s2">valid</span><span class="dl">&#34;</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">save</span><span class="p">(</span><span class="nx">proxy</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">saveAnyway</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="dl">&#34;</span><span class="s2">invalid proxy</span><span class="dl">&#34;</span><span class="p">);</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Bir <code>expressJS</code> <code>Router</code> handler’ı bu: Sisteme bir <code>proxy</code> eklemek istediğinizde çağırdığımız API.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>NodeJS ile back-end yazımına aşina olmayanlar için notlar:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>req</code> gelen isteğe dair bilgileri içerir.</p>
</li>
<li>
<p><code>res.send()</code> isteğe cevap yollamak için kullanılıyor.</p>
</li>
<li>
<p><code>ProxyResource</code> veritabanında tutulan bir model. <code>new</code> denerek oluşturulan nesnelerin <code>save()</code> metodları çağırılarak veritabanına kaydedilebilirler. <code>save()</code> metodu başarılı veya başarısız olabilir ve sonucunu Promise olarak döner.</p>
</li>
<li>
<p><code>Promise</code> asenkron işlemleri birbirlerine zincirleyebilmek için bir yapı.</p>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Her request için sadece ama sadece 1 adet cevap gönderilmeli.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Yapılmak istenen şu:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>İsteğin gövdesinde gönderilen bilgilerle yeni bir proxy oluştur
Eğer &#34;saveAnyway&#34; veya &#34;noHealthCheck&#34; parametlerine bak:
  sadece &#34;saveAnyway&#34; verilmiş ise:
    proxy&#39;yi &#39;valid&#39; olarak işaretle
    proxy&#39;yi kaydet.
    proxy&#39;nin kaydına dair cevap dön
  &#34;noHealthCheck&#34; verilMEmiş ise:
    proxy&#39;nin dogruluğunu kontrol et:
      proxy calışıyor ise:
        proxy&#39;yi &#39;valid&#39; olarak işaretle
        proxy&#39;yi kaydet.
        proxy&#39;nin kaydına dair cevap dön
      değil ise:
        proxy&#39;nin valid olması gerektiğine dair bir hata dön</pre>
</div>
</div>
<div class="paragraph">
<p>Hadi bakalım, istenen davranış ile kodlanmış davranışın arasındaki 7 farkı bulun.</p>
</div>
<div class="paragraph">
<p>Öncelikle, bu kodun (eğer zaten bariz değil ise) neden sorunlu olduğuna bakalım:</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hatalar_ve_sorunlar">Hatalar ve Sorunlar</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En öncelikli hata (testleri patlaması üzerine bu kodu keşfetmemin sebebi de bu) <code>save()</code> Promise içerisinden çağırılıyor ama Promise dönmüyor. <code>save()</code>&#39;in birden fazla defa çağırılabileceğini düşünürsek bu hataya gebe bir durum.</p>
</div>
<div class="listingblock">
<div class="title">save()</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript">  <span class="kd">function</span> <span class="nx">save</span><span class="p">(</span><span class="nx">proxy</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">proxy</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
         <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span>
         <span class="k">return</span> <span class="nx">proxy</span>
      <span class="p">})</span>
  <span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Bu metodu çağıran her yeri de döndüğümüz Promise’i kullanacak şekilde değiştireceğiz. Mesela <code>save()</code> denilip geçilen bir yerde artık <code>return save()</code> demeli.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Kaçıranlar için altını çizeyim, API’mize gelen her bir istek için sadece ama sadece bir cevap dönülmeli. Kodda bu kuralın sağlandığını iddia etmek zor.</p>
</div>
<div class="paragraph">
<p>Bunu daha görsel bir biçimde görmek adına kodun akış şemasını çizeceğim:</p>
</div>
<img src="https://g.gravizo.com/svg?
digraph G {
  &#34;?saveAnyway?&#34; [label=&#34;saveAnyway\nparameter&#34; shape=diamond]
  &#34;?saveAnyway2?&#34; [label=&#34;saveAnyway\nparameter&#34; shape=diamond]
  &#34;?noHealthCheck?&#34; [label=&#34;noHealthCheck\nparameter&#34; shape=diamond]
  &#34;check proxy works?&#34; [label=&#34;check proxy works&#34; shape=diamond]
  &#34;result?&#34; [shape=diamond]
  &#34;save1&#34; [label=&#34;save and respond&#34; style=filled fillcolor=yellow]
  &#34;save2&#34; [label=&#34;save and respond&#34; style=filled fillcolor=yellow]
  &#34;save3&#34; [label=&#34;save and respond&#34; style=filled fillcolor=yellow]
  &#34;proxy.status = valid1&#34; [label=&#34;proxy.status = valid&#34;]

  &#34;start&#34; -&gt; &#34;proxy.status = valid1&#34;
  &#34;proxy.status = valid1&#34; -&gt; &#34;?saveAnyway?&#34;
  &#34;?saveAnyway?&#34; -&gt; &#34;save1&#34; [label=&#34;yes&#34;]
  &#34;?saveAnyway?&#34; -&gt; &#34;?noHealthCheck?&#34; [label=&#34;no&#34;]
  &#34;save1&#34; -&gt; &#34;?noHealthCheck?&#34;
  &#34;?noHealthCheck?&#34; -&gt; &#34;check proxy works?&#34; [label=&#34;no&#34;]
  &#34;check proxy works?&#34; -&gt; &#34;save2&#34; [label=&#34;error&#34;]
  &#34;check proxy works?&#34; -&gt; &#34;result?&#34; [label=&#34;result&#34;]
  &#34;save2&#34; -&gt; &#34;return false&#34;
  &#34;return false&#34; -&gt; &#34;result?&#34;
  &#34;result?&#34; -&gt; &#34;proxy.status = invalid&#34; [label=&#34;false&#34;]
  &#34;result?&#34; -&gt; &#34;proxy.status = valid&#34; [label=&#34;true&#34;]
  &#34;proxy.status = valid&#34; -&gt; &#34;save3&#34;
  &#34;proxy.status = invalid&#34; -&gt; &#34;?saveAnyway2?&#34;
  &#34;?saveAnyway2?&#34; -&gt; &#34;send invalid_proxy response&#34; [label=&#34;no&#34;]
}
"/>
<div class="paragraph">
<p>Veritabanına kaydı yapıp cevap dönen balonu sarıyla işaretledim. Bu işlemi sadece bir defa yapma hakkımız var. Ama akışlara bakarak pek çok halde (mesela <code>saveAnyway</code> verilmiş ise ve proxy’nin çalıştığı denenirken hata olursa) bunun birden fazla yapıldığı görülebiliyor.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title"><code>save and respond</code>&#39;un şeması</div>
<img src="https://g.gravizo.com/svg?
digraph G {
	subgraph cluster_0 {
                node [style=filled fillcolor=white]
		save -&gt; &#34;save successful?&#34; -&gt; &#34;send saved proxy in response&#34;
                &#34;save successful?&#34; -&gt; &#34;send validation error&#34;
                &#34;save successful?&#34; [shape=diamond]
                label=&#34;save and respond&#34;
                style=filled
	}
}
"/>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adım_adım_i̇yileştirme">Adım Adım İyileştirme</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>save and respond</code> bir defa yapılsın istiyor isek, o balondan çıkan tüm okları silebiliriz.</p>
</div>
<img src="https://g.gravizo.com/svg?
digraph G {
  &#34;?saveAnyway?&#34; [label=&#34;saveAnyway\nparameter&#34; shape=diamond]
  &#34;?saveAnyway2?&#34; [label=&#34;saveAnyway\nparameter&#34; shape=diamond]
  &#34;?noHealthCheck?&#34; [label=&#34;noHealthCheck\nparameter&#34; shape=diamond]
  &#34;check proxy works?&#34; [label=&#34;check proxy works&#34; shape=diamond]
  &#34;result?&#34; [shape=diamond]
  &#34;save1&#34; [label=&#34;save and respond&#34; style=dotted]
  &#34;save2&#34; [label=&#34;save and respond&#34; style=dotted]
  &#34;save3&#34; [label=&#34;save and respond&#34; style=filled fillcolor=yellow]
  &#34;proxy.status = valid1&#34; [label=&#34;proxy.status = valid&#34;]
  &#34;return false&#34; [style=dotted]

  &#34;start&#34; -&gt; &#34;proxy.status = valid1&#34;
  &#34;proxy.status = valid1&#34; -&gt; &#34;?saveAnyway?&#34;
  &#34;?saveAnyway?&#34; -&gt; &#34;save1&#34; [style=dotted]
  &#34;?saveAnyway?&#34; -&gt; &#34;save3&#34; [label=&#34;yes&#34; color=red]
  &#34;?saveAnyway?&#34; -&gt; &#34;?noHealthCheck?&#34; [label=&#34;no&#34;]
  &#34;save1&#34; -&gt; &#34;?noHealthCheck?&#34; [style=dotted]
  &#34;?noHealthCheck?&#34; -&gt; &#34;check proxy works?&#34; [label=&#34;no&#34;]
  &#34;check proxy works?&#34; -&gt; &#34;save3&#34; [label=&#34;error&#34; color=red]
  &#34;check proxy works?&#34; -&gt; &#34;save2&#34; [style=dotted]
  &#34;check proxy works?&#34; -&gt; &#34;result?&#34; [label=&#34;result&#34;]
  &#34;save2&#34; -&gt; &#34;return false&#34; [style=dotted]
  &#34;return false&#34; -&gt; &#34;result?&#34; [style=dotted]
  &#34;result?&#34; -&gt; &#34;proxy.status = invalid&#34; [label=&#34;false&#34;]
  &#34;result?&#34; -&gt; &#34;proxy.status = valid&#34; [label=&#34;true&#34;]
  &#34;proxy.status = valid&#34; -&gt; &#34;save3&#34;
  &#34;proxy.status = invalid&#34; -&gt; &#34;?saveAnyway2?&#34;
  &#34;?saveAnyway2?&#34; -&gt; &#34;send invalid_proxy response&#34; [label=&#34;no&#34;]
}
"/>
<div class="paragraph">
<p>Sırada <code>saveAnyway</code> durumunu birden fazla kontrol ediyor olmamız var.</p>
</div>
<div class="paragraph">
<p>Zaten <code>saveAnyway</code> parametresinin değerine bakarak girdiğimiz yolda ayni değere ikinci bir defa bakmamıza gerek yok. Yani:</p>
</div>
<img src="https://g.gravizo.com/svg?
digraph G {
  &#34;?saveAnyway?&#34; [label=&#34;saveAnyway\nparameter&#34; shape=diamond]
  &#34;?saveAnyway2?&#34; [label=&#34;saveAnyway\nparameter&#34; shape=diamond style=dotted]
  &#34;?noHealthCheck?&#34; [label=&#34;noHealthCheck\nparameter&#34; shape=diamond]
  &#34;check proxy works?&#34; [label=&#34;check proxy works&#34; shape=diamond]
  &#34;result?&#34; [shape=diamond]
  &#34;save3&#34; [label=&#34;save and respond&#34;]
  &#34;proxy.status = valid1&#34; [label=&#34;proxy.status = valid&#34;]
  &#34;proxy.status = invalid&#34; [style=dotted]

  &#34;start&#34; -&gt; &#34;proxy.status = valid1&#34;
  &#34;proxy.status = valid1&#34; -&gt; &#34;?saveAnyway?&#34;
  &#34;?saveAnyway?&#34; -&gt; &#34;save3&#34; [label=&#34;yes&#34;]
  &#34;?saveAnyway?&#34; -&gt; &#34;?noHealthCheck?&#34; [label=&#34;no&#34;]
  &#34;?noHealthCheck?&#34; -&gt; &#34;check proxy works?&#34; [label=&#34;no&#34;]
  &#34;check proxy works?&#34; -&gt; &#34;save3&#34; [label=&#34;error&#34;]
  &#34;check proxy works?&#34; -&gt; &#34;result?&#34; [label=&#34;result&#34;]
  &#34;result?&#34; -&gt; &#34;send invalid_proxy response&#34; [label=&#34;false&#34; color=red]
  &#34;result?&#34; -&gt; &#34;proxy.status = invalid&#34; [style=dotted]
  &#34;result?&#34; -&gt; &#34;proxy.status = valid&#34; [label=&#34;true&#34;]
  &#34;proxy.status = valid&#34; -&gt; &#34;save3&#34;
  &#34;proxy.status = invalid&#34; -&gt; &#34;?saveAnyway2?&#34; [style=dotted]
  &#34;?saveAnyway2?&#34; -&gt; &#34;send invalid_proxy response&#34; [style=dotted]
}
"/>
<div class="paragraph">
<p><code>proxy.status = valid</code> atamasının da 2 defa yapılmasına gerek yok.</p>
</div>
<img src="https://g.gravizo.com/svg?
digraph G {
  &#34;?saveAnyway?&#34; [label=&#34;saveAnyway\nparameter&#34; shape=diamond]
  &#34;?noHealthCheck?&#34; [label=&#34;noHealthCheck\nparameter&#34; shape=diamond]
  &#34;check proxy works?&#34; [label=&#34;check proxy works&#34; shape=diamond]
  &#34;result?&#34; [shape=diamond]
  &#34;save3&#34; [label=&#34;save and respond&#34;]
  &#34;proxy.status = valid1&#34; [label=&#34;proxy.status = valid&#34; style=dotted]
  &#34;proxy.status = valid&#34; [style=filled fillcolor=yellow]

  &#34;start&#34; -&gt;  &#34;proxy.status = valid1&#34; [style=dotted]
  &#34;start&#34; -&gt;  &#34;?saveAnyway?&#34; [color=red]
  &#34;proxy.status = valid1&#34; -&gt; &#34;?saveAnyway?&#34; [style=dotted]
  &#34;?saveAnyway?&#34; -&gt; &#34;proxy.status = valid&#34; [label=&#34;yes&#34; color=red]
  &#34;?saveAnyway?&#34; -&gt; &#34;?noHealthCheck?&#34; [label=&#34;no&#34;]
  &#34;?noHealthCheck?&#34; -&gt; &#34;check proxy works?&#34; [label=&#34;no&#34;]
  &#34;check proxy works?&#34; -&gt; &#34;proxy.status = valid&#34; [label=&#34;error&#34; color=red]
  &#34;check proxy works?&#34; -&gt; &#34;result?&#34; [label=&#34;result&#34;]
  &#34;result?&#34; -&gt; &#34;send invalid_proxy response&#34; [label=&#34;false&#34;]
  &#34;result?&#34; -&gt; &#34;proxy.status = valid&#34; [label=&#34;true&#34;]
  &#34;proxy.status = valid&#34; -&gt; &#34;save3&#34;
}
"/>
<div class="paragraph">
<p><code>noHealthCheck</code> parametresi olmadığı vakit ne yapacağımız tanımlı değil. Parametreyi görmezden gelebiliriz (o kutuyu silerek); ama API’nin yapmak istediği <code>saveAnyway</code> parametresi verilmiş ise <code>invalid</code> olan proxy’leri de kaydetmek.</p>
</div>
<div class="paragraph">
<p>Ki bu şemayı şu hale sokuyor:</p>
</div>
<img src="https://g.gravizo.com/svg?
digraph G {
  &#34;?saveAnyway?&#34; [label=&#34;saveAnyway\nparameter&#34; shape=diamond]
  &#34;?noHealthCheck?&#34; [label=&#34;noHealthCheck\nparameter&#34; shape=diamond]
  &#34;check proxy works?&#34; [label=&#34;check proxy works&#34; shape=diamond]
  &#34;result?&#34; [shape=diamond]
  &#34;save3&#34; [label=&#34;save and respond&#34;]

  &#34;start&#34; -&gt;  &#34;?noHealthCheck?&#34;
  &#34;?noHealthCheck?&#34; -&gt; &#34;proxy.status = valid&#34; [label=&#34;yes&#34;]
  &#34;?noHealthCheck?&#34; -&gt; &#34;check proxy works?&#34; [label=&#34;no&#34;]
  &#34;check proxy works?&#34; -&gt; &#34;proxy.status = valid&#34; [label=&#34;error&#34;]
  &#34;check proxy works?&#34; -&gt; &#34;result?&#34; [label=&#34;result&#34;]
  &#34;result?&#34; -&gt; &#34;?saveAnyway?&#34; [label=&#34;false&#34;]
  &#34;result?&#34; -&gt; &#34;proxy.status = valid&#34; [label=&#34;true&#34;]
  &#34;?saveAnyway?&#34; -&gt; &#34;send invalid_proxy error&#34; [label=&#34;no&#34;]
  &#34;?saveAnyway?&#34; -&gt; &#34;proxy.status = invalid&#34; [label=&#34;yes&#34;]
  &#34;proxy.status = valid&#34; -&gt; &#34;save3&#34;
  &#34;proxy.status = invalid&#34; -&gt; &#34;save3&#34;
}
"/>
<div class="paragraph">
<p><code>save and respond</code> işlemini açarsak:</p>
</div>
<img src="https://g.gravizo.com/svg?
digraph G {
  &#34;?saveAnyway?&#34; [label=&#34;saveAnyway\nparameter&#34; shape=diamond]
  &#34;?noHealthCheck?&#34; [label=&#34;noHealthCheck\nparameter&#34; shape=diamond]
  &#34;check proxy works?&#34; [label=&#34;check proxy works&#34; shape=diamond]
  &#34;result?&#34; [shape=diamond]
  &#34;save ok?&#34; [label=&#34;save succesful?&#34; shape=diamond]

  &#34;start&#34; -&gt;  &#34;?noHealthCheck?&#34;
  &#34;?noHealthCheck?&#34; -&gt; &#34;proxy.status = valid&#34; [label=&#34;yes&#34;]
  &#34;?noHealthCheck?&#34; -&gt; &#34;check proxy works?&#34; [label=&#34;no&#34;]
  &#34;check proxy works?&#34; -&gt; &#34;proxy.status = valid&#34; [label=&#34;error&#34;]
  &#34;check proxy works?&#34; -&gt; &#34;result?&#34; [label=&#34;result&#34;]
  &#34;result?&#34; -&gt; &#34;?saveAnyway?&#34; [label=&#34;false&#34;]
  &#34;result?&#34; -&gt; &#34;proxy.status = valid&#34; [label=&#34;true&#34;]
  &#34;?saveAnyway?&#34; -&gt; &#34;send invalid_proxy error&#34; [label=&#34;no&#34;]
  &#34;?saveAnyway?&#34; -&gt; &#34;proxy.status = invalid&#34; [label=&#34;yes&#34;]
  &#34;proxy.status = valid&#34; -&gt; &#34;save&#34;
  &#34;proxy.status = invalid&#34; -&gt; &#34;save&#34;
  &#34;save&#34; -&gt; &#34;save ok?&#34;
  &#34;save ok?&#34; -&gt; &#34;send validation error&#34; [label=&#34;no&#34;]
  &#34;save ok?&#34; -&gt; &#34;send saved proxy in response&#34; [label=&#34;yes&#34;]}
"/>
<div class="paragraph">
<p>Peki bu şemayı ilk şemamızla kıyaslarsak dikkat çeken şeyler neler?</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Sadece bir yerde kaydediyor, bir yerde cevap dönüyoruz.</p>
</li>
<li>
<p>Cevap dönmek yaptığımız son işlem</p>
</li>
<li>
<p>Şema yukarıdan aşağıya doğru okunabiliyor.</p>
</li>
<li>
<p>Akışta bir dallanma olmuş ve bu dallar tekrar birleşmişse eğer, bunun nasıl olduğu değil sonucu bizi ilgilendiriyor. Örneğin <code>status = valid</code> derken bunun <code>noHealthCheck</code> dendiği için mi yoksa proxy kontrolünde hata çıktığı için mi olduğunu umursamıyoruz; <code>status</code>&#39;un <code>valid</code> olarak atanması isteğiyle ilgileniyoruz sadece.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Tüm bu maddeler de zaten Promise kullanarak bunun inşaa edilebileceğine ipucu veriyor.</p>
</div>
<div class="listingblock">
<div class="title">yeni kodumuz</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">route</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">&#34;</span><span class="s2">/api/proxy</span><span class="dl">&#34;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
   <span class="kd">let</span> <span class="nx">noHealthCheck</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">noHealthCheck</span>
   <span class="kd">let</span> <span class="nx">saveAnyway</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">saveAnyway</span>
   <span class="kd">let</span> <span class="nx">proxy</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Proxy</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span>

   <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
         <span class="k">if</span> <span class="p">(</span><span class="nx">noHealthCheck</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span>
               <span class="nx">HealthService</span><span class="p">.</span><span class="nx">checkProxy</span><span class="p">(</span><span class="nx">proxy</span><span class="p">)</span>
                  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">_</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">)</span>
            <span class="p">)</span>
         <span class="p">}</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">isValid</span> <span class="o">=&gt;</span> <span class="p">{</span>
         <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isValid</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">saveAnyway</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">&#34;</span><span class="s2">proxy is invalid</span><span class="dl">&#34;</span><span class="p">)</span>
         <span class="p">}</span>
         <span class="nx">proxy</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="nx">isValid</span> <span class="p">?</span> <span class="dl">&#34;</span><span class="s2">valid</span><span class="dl">&#34;</span> <span class="p">:</span> <span class="dl">&#34;</span><span class="s2">invalid</span><span class="dl">&#34;</span>
         <span class="k">return</span> <span class="nx">proxy</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">proxy</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">proxy</span><span class="p">))</span>
      <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="nx">err</span><span class="p">))</span>
<span class="p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Az evvel vurguladığım 4 maddeyi burada da bulabiliriz:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>res.send</code> ve <code>proxy.save()</code> bir yerde yapılıyor</p>
</li>
<li>
<p><code>res.send</code> yaptığımız son işlem</p>
</li>
<li>
<p>(ve 4) Promise zincirinin her bir halkası (<code>then</code> (veya <code>catch</code>) statement’ları) da kendi başına manalı. <code>isValid ⇒ …​</code> adımında bu <code>isValid</code> değerinin nereden geldiğini umursamadan onu kullanabiliriz. Bu sayede kodu yukarıdan aşağıya okuyabiliyoruz.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_maybe_akışı">Maybe Akışı</h3>
<div class="paragraph">
<p>Promise olmadan da bu gibi akışlar inşaa edilebilir. Güzel bir örnek Maybe’ye değindiğim <a href="http:///posts/repl-driven-development/">önceki bir yazımda</a> vardı; Luhn doğrulama algoritmasını yazmıştım. Onun şemasını hayal etsek:</p>
</div>
<div class="listingblock">
<div class="title">Luhn doğrulama</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript">  <span class="k">new</span> <span class="nx">Just</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">&#34;&#34;</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">l</span> <span class="o">=&gt;</span> <span class="nx">l</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">!=</span> <span class="dl">&#34;</span><span class="s2"> </span><span class="dl">&#34;</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">l</span> <span class="o">=&gt;</span> <span class="nx">l</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">x</span><span class="p">)))</span>
    <span class="p">.</span><span class="nx">chain</span><span class="p">(</span><span class="nx">safe</span><span class="p">(</span><span class="nx">l</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">l</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="kc">NaN</span><span class="p">)))</span>
    <span class="p">.</span><span class="nx">chain</span><span class="p">(</span><span class="nx">safe</span><span class="p">(</span><span class="nx">l</span> <span class="o">=&gt;</span> <span class="nx">l</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">l</span> <span class="o">=&gt;</span> <span class="nx">l</span><span class="p">.</span><span class="nx">reverse</span><span class="p">())</span>
    <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">l</span> <span class="o">=&gt;</span> <span class="nx">l</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">x</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span>
                                <span class="p">?</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                                <span class="p">:</span> <span class="nx">x</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">l</span> <span class="o">=&gt;</span> <span class="nx">l</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">&gt;=</span> <span class="mi">10</span>
                           <span class="p">?</span> <span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="mi">9</span><span class="p">)</span>
                           <span class="p">:</span> <span class="nx">x</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">sumList</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">withDefault</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span></code></pre>
</div>
</div>
<img src="https://g.gravizo.com/svg?
digraph G {
 &#34;a string&#34; [shape=rectangle]
 &#34;has NaN?&#34; [shape=diamond]
 &#34;length &gt; 1?&#34; [shape=diamond]
 &#34;divides 10?&#34; [shape=diamond]

 &#34;a string&#34; -&gt; &#34;split&#34;
 &#34;split&#34; -&gt; &#34;filter out spaces&#34;
 &#34;filter out spaces&#34; -&gt; &#34;parseInt&#34;
 &#34;parseInt&#34; -&gt; &#34;has NaN?&#34;
 &#34;has NaN?&#34; -&gt; &#34;length &gt; 1?&#34;
 &#34;has NaN?&#34; -&gt; &#34;false&#34; [label=&#34;no&#34;]
 &#34;length &gt; 1?&#34; -&gt; &#34;reverse&#34;
 &#34;length &gt; 1?&#34; -&gt; &#34;false&#34; [label=&#34;no&#34;]
 &#34;reverse&#34; -&gt; &#34;*2 every other item&#34;
 &#34;*2 every other item&#34; -&gt; &#34;-9 each item if &gt;= 10&#34;
 &#34;-9 each item if &gt;= 10&#34; -&gt; &#34;sum&#34;
 &#34;sum&#34; -&gt; &#34;divides 10?&#34;
 &#34;divides 10?&#34; -&gt; &#34;true&#34;
 &#34;divides 10?&#34; -&gt; false [label=&#34;no&#34;]
}
"/>
<div class="paragraph">
<p>Bu örnekte daha da tek bir yatağa sınırlı bir akış görülebiliyor. Tüm akış tek bir noktada sonlanıyor ve tüm hatalar <code>false</code> baloncuğunda toplanıyor.</p>
</div>
<div class="paragraph">
<p>Hataları yönetmek için Promise’lerden veya Maybe’den faydalanamayacak olsak, bu akışı <em>erken-kaçış (early return)</em> ile temsil edebilirdik.</p>
</div>
<div class="listingblock">
<div class="title">Early-return ile Luhn doğrulama</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">const</span> <span class="nx">luhn</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">digits</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">&#34;&#34;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">!=</span> <span class="dl">&#34;</span><span class="s2"> </span><span class="dl">&#34;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">c</span><span class="p">))</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">digits</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="kc">NaN</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">digits</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">sumList</span><span class="p">(</span><span class="nx">digits</span><span class="p">.</span><span class="nx">reverse</span><span class="p">()</span>
                       <span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">x</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span>
                                        <span class="p">?</span> <span class="p">(</span><span class="nx">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                                        <span class="p">:</span> <span class="nx">x</span><span class="p">)</span>
                       <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">&gt;=</span> <span class="mi">10</span>
                                   <span class="p">?</span> <span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="mi">9</span><span class="p">)</span>
                                   <span class="p">:</span> <span class="nx">x</span><span class="p">)</span>
                <span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span>

<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Aynı akış hissini bu kod da verebiliyor.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>Maybe</code> kullanmak istememin sebebi hata yönetimi için yegane çözüm olduğu için değil. <code>Maybe</code> bizi <code>Nothing</code> durumunu gözetmeye zorladığı için kullanılmasını teşvik ettiğim bir hazne tipi.</p>
</div>
<div class="listingblock">
<div class="title">parseInt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="haskell"><span class="n">parseInt</span> <span class="o">::</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Number</span><span class="o">|</span><span class="kt">NaN</span>
<span class="n">parseIntSafe</span> <span class="o">::</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Maybe</span> <span class="kt">Number</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Javascript eğer <code>parseInt</code> için <code>Maybe</code> dönüyor olsa biz hata durumunu görmezden gelemeyecektik; <code>Maybe</code>&#39;den <code>Number</code>&#39;ı çıkarmak için yapabileceğimiz her şey bir şekilde bu hata durumunun kontrolü olacaktı.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Çoğu problem de aslında basit bir akış şemasına denk gelebiliyor. Gereğinden karmaşık; okuması veya anlaması zor bir kodla karşı karşıyaysanız bunun bir de akış şeması olarak nasıl olabileceğini düşünün. Belki de çözümü sadeleştirmek için gereken şey, <em>-beyaz yakalı bir ailenin gönderildiği özel okulda programlama öğretilen 8 yaşındaki çocuğu gibi-</em> akış şeması üzerinden basit çözümler üretmektir.</p>
</div>
</div>
</div>
</div>

  </div>

  <div id=links>
    
      <a href="/posts/wolf-sheep-grass/">&laquo;&nbsp;Kurt, Koyun, Ot</a>
    
    
      <a href="/posts/goodbye-dark/">Güle Güle Karanlık, Hoşgeldin Karanlık&nbsp;&raquo;</a>
    
  </div>
</section>

  
</body>
</html>



